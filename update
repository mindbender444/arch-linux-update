#!/bin/bash

## FUNCTIONS ##
#Upgrade using pacman
pacman_f() { 
    sudo pacman -Syu
    exit
} 

#Upgrade using yay
yay_f() { 
    yay -Syu
    exit
} 

make_snap() {
	
	#Stamp it!
	TIMESTAMP=`date +"%Y-%m-%d-%H%M%S"`

	#Create snapshot
	echo "Creating snapshot..."
	sudo btrfs subvolume snapshot -r / /.snapshots/$TIMESTAMP

	#Update GRUB
	echo "Updating GRUB..."
	sudo grub-mkconfig -o /boot/grub/grub.cfg
}

##END OF FUNCTIONS##

#Check for news if informant is installed
if which informant > /dev/null; then
echo "Checking for news from Arch linux using informant..."
sudo informant read
echo "Done checking for news..."
fi

#Snapshot?
while true; do
    read -p "Do you want to make a snapshot?" yn
    case $yn in
        [Yy]* ) make_snap && break;;
        [Nn]* ) break;;
        * ) echo "Please answer yes or no.";;
    esac
done

#Snapshot?
while true; do
    read -p "Do you want to continue with the upgrade?" yn
    case $yn in
        [Yy]* ) break;;
        [Nn]* ) exit;;
        * ) echo "Please answer yes or no.";;
    esac
done

#Upgrade with...?
PS3="Select option: "

select opt in pacman yay quit; do

  case $opt in
    pacman)
	pacman_f
      ;;
    yay)
	yay_f
      ;;
    quit)
      	break
      ;;
    *) 
      echo "Invalid option $REPLY"
      ;;
  esac
done
